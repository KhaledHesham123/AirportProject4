@model AirportProject4.Shared.PaginatedListDto<AirportProject4.Project.core.Entities.main.Flight>

@{
    ViewData["Title"] = "Flights Overview";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-5">
    <h1 class="mb-4 text-center">Flights Overview</h1>

    @if (Model == null || Model.Items == null || !Model.Items.Any())
    {
        <div class="alert alert-info text-center">No flights available.</div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-4">
            @foreach (var flight in Model.Items)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm border-primary">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <span>Flight: <strong>@flight.FlightNumber</strong></span>
                            <span class="badge bg-light text-dark">@flight.Tickets.Count booked</span>
                        </div>

                        <div class="card-body">
                            <div class="mb-2">
                                <strong>Route:</strong> @flight.DepartureAirport <i class="bi bi-arrow-right"></i> @flight.ArrivalAirport
                            </div>

                            <div class="mb-2">
                                <strong>Departure:</strong> @flight.DepartureTime.ToString("dd MMM yyyy HH:mm") <br />
                                <strong>Arrival:</strong> @flight.ArrivalTime.ToString("dd MMM yyyy HH:mm")
                            </div>

                            <div class="mb-2">
                                <strong>Aircraft:</strong> @flight.Aircraft?.Model <br />
                                <strong>Airline:</strong> @flight.Aircraft?.Airline?.Name
                            </div>

                            <a asp-controller="Flight"
                               asp-action="FlightUpdate"
                               asp-route-id="@flight.Id"
                               class="btn btn-warning btn-sm mt-2">
                                Update
                            </a>

                            <div class="mb-3 mt-3">
                                <strong>Seats (@flight.Seats.Count):</strong>
                                @if (flight.Seats.Any())
                                {
                                    <ul class="list-inline mb-0">
                                        @foreach (var seat in flight.Seats)
                                        {
                                            <li class="list-inline-item badge bg-secondary m-1">@seat.SeatNumber (@seat.Class)</li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <span class="text-muted">No seats available</span>
                                }
                            </div>

                            <div>
                                <strong>Tickets & Passengers (@flight.Tickets.Count):</strong>
                                @if (flight.Tickets.Any())
                                {
                                    <table class="table table-sm table-striped mt-2">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Ticket ID</th>
                                                <th>Price</th>
                                                <th>Passenger</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var ticket in flight.Tickets)
                                            {
                                                <tr>
                                                    <td>@ticket.Id</td>
                                                    <td>@ticket.Price.ToString("C")</td>
                                                    <td>@ticket.User?.FullName (@ticket.User?.PassportNumber)</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                }
                                else
                                {
                                    <span class="text-muted">No tickets booked yet</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- ✅ Pagination -->
        <nav class="mt-5">
            <ul class="pagination justify-content-center">
                @if (Model.PageNumber > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("GetAllFlights", new { pageNumber = Model.PageNumber - 1, pageSize = Model.PageSize })">Previous</a>
                    </li>
                }

                @for (int i = 1; i <= Math.Ceiling((double)Model.TotalCount / Model.PageSize); i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link" href="@Url.Action("GetAllFlights", new { pageNumber = i, pageSize = Model.PageSize })">@i</a>
                    </li>
                }

                @if (Model.PageNumber < Math.Ceiling((double)Model.TotalCount / Model.PageSize))
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("GetAllFlights", new { pageNumber = Model.PageNumber + 1, pageSize = Model.PageSize })">Next</a>
                    </li>
                }
            </ul>
        </nav>
    }
</div>
