@model AirportProject4.Shared.PaginatedListDto<AirportProject4.Project.core.DTOS.FlightsDto.AvailableFlightDto>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container my-5">
    <!-- Search form -->
    <form asp-action="getAvailableFlights" asp-controller="Flight" method="get" class="mb-4">
        <div class="input-group">
            <input type="text" name="search" value="@Context.Request.Query["search"]" class="form-control" placeholder="Search by Flight Number...">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    <h1 class="mb-4 text-center text-primary fw-bold">✈️ Available Flights</h1>

    @if (Model == null || Model.Items == null || !Model.Items.Any())
    {
        <div class="alert alert-warning text-center p-4 rounded shadow">
            No Available Flights at the moment.
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var flight in Model.Items)
            {
                <div class="col">
                    <div class="card shadow-lg border-0 h-100">
                        <!-- Flight Header -->
                        <div class="card-header bg-primary text-white text-center fw-bold">
                            Flight @flight.FlightNumber
                        </div>

                        <!-- Flight Body -->
                        <div class="card-body">
                            <h5 class="card-title text-center text-secondary mb-3">
                                @flight.AirlineName - @flight.AircraftModel
                            </h5>
                            <div class="mb-2"><strong>From:</strong> @flight.DepartureAirport</div>
                            <div class="mb-2"><strong>To:</strong> @flight.ArrivalAirport</div>
                            <div class="mb-2"><strong>Departure:</strong> @flight.DepartureTime.ToString("dd-MM-yyyy HH:mm")</div>
                            <div class="mb-2"><strong>Arrival:</strong> @flight.ArrivalTime.ToString("dd-MM-yyyy HH:mm")</div>

                            <hr />

                            <div class="d-flex justify-content-between">
                                <span class="badge bg-info">Total: @flight.TotalSeats</span>
                                <span class="badge bg-warning text-dark">Booked: @flight.BookedSeats</span>
                                <span class="badge bg-success">Available: @flight.AvailableSeats</span>
                            </div>
                        </div>

                        <!-- Buttons Footer -->
                        <div class="card-footer text-center bg-light">
                            <!-- Book Now Button -->
                            <a asp-action="Book"
                               asp-controller="Flight"
                               asp-route-id="@flight.FlightId"
                               class="btn btn-outline-primary btn-sm">
                                Book Now
                            </a>

                            <!-- Details Button -->
                            <a asp-action="Details"
                               asp-controller="Flight"
                               asp-route-id="@flight.FlightId"
                               class="btn btn-outline-secondary btn-sm">
                                Details
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination Controls -->
        <nav class="mt-5">
            <ul class="pagination justify-content-center">
                @{
                    var prevDisabled = Model.PageNumber <= 1 ? "disabled" : "";
                    var nextDisabled = Model.PageNumber >= Math.Ceiling((double)Model.TotalCount / Model.PageSize) ? "disabled" : "";
                }

                <li class="page-item @prevDisabled">
                    <a class="page-link"
                       asp-action="getAvailableFlights"
                       asp-route-pageNumber="@(Model.PageNumber - 1)"
                       asp-route-pageSize="@Model.PageSize"
                       asp-route-search="@Context.Request.Query["search"]">
                        Previous
                    </a>
                </li>

                <li class="page-item disabled">
                    <span class="page-link">
                        Page @Model.PageNumber of @Math.Ceiling((double)Model.TotalCount / Model.PageSize)
                    </span>
                </li>

                <li class="page-item @nextDisabled">
                    <a class="page-link"
                       asp-action="getAvailableFlights"
                       asp-route-pageNumber="@(Model.PageNumber + 1)"
                       asp-route-pageSize="@Model.PageSize"
                       asp-route-search="@Context.Request.Query["search"]">
                        Next
                    </a>
                </li>
            </ul>
        </nav>
    }
</div>
